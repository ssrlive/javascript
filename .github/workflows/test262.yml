name: test262-integration

on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  run-test262-subset-1:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/arguments-object" - "language/export"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/arguments-object,language/asi,language/block-scope,language/comments,language/computed-property-names,language/destructuring,language/directive-prologue,language/eval-code,language/export

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-1
          path: test262-results.log

  run-test262-subset-2:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/expressions/addition" - "language/expressions/assignment"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/expressions/addition,language/expressions/array,language/expressions/arrow-function,language/expressions/assignment

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-2
          path: test262-results.log

  run-test262-subset-3:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/expressions/assignmenttargettype" - "language/expressions/await"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/expressions/assignmenttargettype,language/expressions/async-arrow-function,language/expressions/async-function,language/expressions/async-generator,language/expressions/await

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-3
          path: test262-results.log

  run-test262-subset-4:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/expressions/bitwise-and" - "language/expressions/call"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/expressions/bitwise-and,language/expressions/bitwise-not,language/expressions/bitwise-or,language/expressions/bitwise-xor,language/expressions/call

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-4
          path: test262-results.log

  run-test262-subset-5:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/expressions/class/accessor-name-inst" - "language/expressions/class/decorator"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/expressions/class/accessor-name-inst,language/expressions/class/accessor-name-static,language/expressions/class/async-gen-method,language/expressions/class/async-gen-method-static,language/expressions/class/async-method,language/expressions/class/async-method-static,language/expressions/class/decorator

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-5
          path: test262-results.log

  run-test262-subset-6:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/expressions/class/dstr" - "language/expressions/class/dstr"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/expressions/class/dstr

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-6
          path: test262-results.log

  run-test262-subset-7:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/expressions/class/elements" - "language/expressions/class/elements"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/expressions/class/elements

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-7
          path: test262-results.log

  run-test262-subset-8:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/expressions/class/gen-method" - "language/expressions/class/(filesonly)"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/expressions/class/gen-method,language/expressions/class/gen-method-static,language/expressions/class/method,language/expressions/class/method-static,language/expressions/class/subclass-builtins,"language/expressions/class/(filesonly)"

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-8
          path: test262-results.log

  run-test262-subset-9:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/expressions/coalesce" - "language/expressions/does-not-equals"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/expressions/coalesce,language/expressions/comma,language/expressions/compound-assignment,language/expressions/concatenation,language/expressions/conditional,language/expressions/delete,language/expressions/division,language/expressions/does-not-equals

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-9
          path: test262-results.log

  run-test262-subset-10:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/expressions/coalesce" - "language/expressions/does-not-equals"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/expressions/dynamic-import

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-10
          path: test262-results.log

  run-test262-subset-11:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/expressions/equals" - "language/expressions/generators"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/expressions/equals,language/expressions/exponentiation,language/expressions/function,language/expressions/generators

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-11
          path: test262-results.log

  run-test262-subset-12:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/expressions/greater-than" - "language/expressions/void"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/expressions/greater-than,language/expressions/greater-than-or-equal,language/expressions/less-than,language/expressions/less-than-or-equal,language/expressions/logical-and,language/expressions/logical-assignment,language/expressions/logical-not,language/expressions/logical-or,language/expressions/void

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-12
          path: test262-results.log

  run-test262-subset-13:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/expressions/grouping" - "language/expressions/prefix-increment"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/expressions/grouping,language/expressions/import.meta,language/expressions/in,language/expressions/instanceof,language/expressions/left-shift,language/expressions/right-shift,language/expressions/optional-chaining,language/expressions/member-expression,language/expressions/modulus,language/expressions/multiplication,language/expressions/new,language/expressions/new.target,language/expressions/postfix-decrement,language/expressions/postfix-increment,language/expressions/prefix-decrement,language/expressions/prefix-increment

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-13
          path: test262-results.log

  run-test262-subset-14:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/expressions/object"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/expressions/object

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-14
          path: test262-results.log

  run-test262-subset-15:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt

      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Build JavaScript engine
        run: |
          cargo build --all-features --example js

      - name: Run a small test262 subset - "language/expressions/property-accessors" - "language/expressions/unsigned-right-shift"
        if: ${{ !cancelled() }}
        env:
          FAIL_ON_FAILURE: 'true'
        run: |
          node ci/runner.js --limit 10000 --focus language/expressions/property-accessors,language/expressions/relational,language/expressions/strict-does-not-equals,language/expressions/strict-equals,language/expressions/subtraction,language/expressions/super,language/expressions/tagged-template,language/expressions/template-literal,language/expressions/this,language/expressions/typeof,language/expressions/unary-minus,language/expressions/unary-plus,language/expressions/unsigned-right-shift

      - name: Upload results
        if: ${{ !cancelled() }}
        uses: actions/upload-artifact@v4
        with:
          name: test262-results-15
          path: test262-results.log

